function switchStatus(event={},forceStatus=2,smartWait=!1){2==forceStatus?video.paused?(video.play(),audio.play(),smartWait||(states.playing=!0)):(video.pause(),audio.pause(),smartWait||(states.playing=!1)):0==forceStatus?(video.play(),audio.play(),smartWait||(states.playing=!0)):1==forceStatus&&(video.pause(),audio.pause(),smartWait||(states.playing=!1))}function nte(time,float=!1){let timeArguments=[0,0,0];timeArguments[2]=time%60,timeArguments[1]=Math.floor(time/60)%60,timeArguments[0]=Math.floor(time/3600),float||(timeArguments[2]=Math.floor(timeArguments[2]));let hasHour=!1;timeArguments[0]>0&&(hasHour=!0),timeArguments.forEach((e,i,a)=>{a[i]=e<10?"0"+e:e.toString()});let timeString=timeArguments[1]+":"+timeArguments[2];return hasHour&&(timeString=timeArguments[0]+":"+timeString),timeString}function getControllers(){let controllers={};return controllers.progress=document.querySelector("#btn-progress"),controllers.play=document.querySelector("#btn-play"),controllers.fsc=document.querySelector("#btn-fsc"),controllers.list=document.querySelector("#btn-list"),controllers.prev=document.querySelector("#btn-prev"),controllers.next=document.querySelector("#btn-next"),controllers.amp=document.querySelector("#btn-vol"),controllers.conf=document.querySelector("#btn-conf"),controllers}function getIndicators(){let indicators={};return indicators.buffer=document.querySelector("#buffer-progress"),indicators.visualizer=document.querySelector("#c-visualizer"),indicators.currentTime=document.querySelector("#idct-curr"),indicators.duration=document.querySelector("#idct-dura"),indicators}function getWae(){let wae={};return wae.cover=document.querySelector("#wae-meta img"),wae}function getAll(){return{controllers:getControllers(),indicators:getIndicators(),wae:getWae()}}function resizeAll(){let element=getAll();element.controllers.progress.style.width=(innerWidth-8).toString()+"px",element.indicators.buffer.width=innerWidth-8}function loadFiles(files){Array.from(files).forEach(e=>{console.log(lang.fileLoading.replace("$1",e.name));let nameArr=e.name.toLowerCase().split(".");switch(nameArr[nameArr.length-1]){case"flv":console.log(lang.formatDetected.replace("$1","FLV").replace("$2","video/flv")),currentMedia.vidurl&&(currentMedia.vidurl.indexOf("blob:")<1&&(URL.revokeObjectURL(currentMedia.vidurl),currentMedia.audblob=null),currentMedia.audurl&&currentMedia.audurl!=currentMedia.vidurl&&currentMedia.vidurl.indexOf("blob:")<1&&URL.revokeObjectURL(currentMedia.audurl),currentMedia.audurl=null,currentMedia.vidurl=null,currentMedia.vidname=null),currentMedia.vidurl=URL.createObjectURL(e),currentMedia.vidname=e,currentMedia.audurl=currentMedia.vidurl,flvPlayer&&(flvPlayer.unload(),flvPlayer=null),flvPlayerAudio&&(flvPlayerAudio.unload(),flvPlayerAudio=null),flvPlayer=flvjs.createPlayer({type:"flv",url:currentMedia.vidurl}),flvPlayer.attachMediaElement(video),flvPlayer.load(),flvPlayerAudio=flvjs.createPlayer({type:"flv",url:currentMedia.vidurl}),flvPlayerAudio.attachMediaElement(audio),flvPlayerAudio.load();break;default:flvPlayer&&(flvPlayer.unload(),flvPlayer=null),flvPlayerAudio&&(flvPlayerAudio.unload(),flvPlayerAudio=null),console.log(lang.formatDetected.replace("$1",nameArr[nameArr.length-1].toUpperCase()).replace("$2",e.type)),0==e.type.indexOf("video")||0==e.type.indexOf("audio")?playMedia(e):console.log(lang.unsupportedFileType.replace("$1",nameArr[nameArr.length-1].toUpperCase()).replace("$2",e.type))}})}function seekMedia(time){time.constructor==Number&&(video.currentTime=time,audio.currentTime=time,console.info(lang.seekMedia))}function playMedia(source,start=0,audioOnly=!1,format="auto"){currentMedia.vidurl&&(currentMedia.vidurl.indexOf("blob:")<1&&(URL.revokeObjectURL(currentMedia.vidurl),currentMedia.audblob=null),currentMedia.audurl&&currentMedia.audurl!=currentMedia.vidurl&&currentMedia.vidurl.indexOf("blob:")<1&&URL.revokeObjectURL(currentMedia.audurl),currentMedia.audurl=null,currentMedia.vidurl=null,currentMedia.vidname=null),source.constructor==String?(audioOnly||(video.src=source,currentMedia.vidurl=source,seekMedia(start)),audio.src=source,currentMedia.audurl=source):audioOnly?(currentMedia.audurl=URL.createObjectURL(source),currentMedia.audblob=source,audio.src=currentMedia.audurl):(currentMedia.vidurl=URL.createObjectURL(source),currentMedia.vidname=source.name,currentMedia.audurl=currentMedia.vidurl,currentMedia.audblob=source,video.src=currentMedia.vidurl,audio.src=currentMedia.audurl)}function startThreads(){let elements=getAll();threads.progress={func:function(){states.seek?elements.indicators.currentTime.innerHTML=nte(parseFloat(elements.controllers.progress.value)*video.duration):video.duration>0?elements.controllers.progress.value=video.currentTime/video.duration:elements.controllers.progress.value=0,states.seek?elements.indicators.currentTime.style.fontWeight="bold":elements.indicators.currentTime.style.fontWeight="normal",elements.indicators.currentTime.innerHTML=nte(video.currentTime);let ctx=canvas.buffer;switch(ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),document.body.className){case"theme-greenb":ctx.fillStyle="rgba(0, 255, 0, 0.5)";break;case"theme-blueb":ctx.fillStyle="rgba(16, 160, 255, 0.5)";break;default:ctx.fillStyle="rgba(160, 160, 160, 0.5)"}ctx.fillRect(0,5,Math.floor(ctx.canvas.width*elements.controllers.progress.value),4);let videoBuffer=video.buffered,audioBuffer=audio.buffered;for(let t=0;t<videoBuffer.length;t++)ctx.fillRect(Math.round(ctx.canvas.width*(videoBuffer.start(t)/video.duration)),0,Math.round(ctx.canvas.width*((videoBuffer.end(t)-videoBuffer.start(t))/video.duration)),4);for(let t=0;t<audioBuffer.length;t++)ctx.fillRect(Math.round(ctx.canvas.width*(audioBuffer.start(t)/audio.duration)),10,Math.round(ctx.canvas.width*((audioBuffer.end(t)-audioBuffer.start(t))/audio.duration)),4)},focus:30,blur:6,hidden:0,thread:-1};for(let name in threads)threads[name].thread=setInterval(threads[name].func,1e3/threads[name].focus),console.info(lang.threadOnline.replace("$1",name).replace("$2",threads[name].focus))}function videoLoadStart(){getWae().cover.style.display="none",console.log(lang.mediaStartedLoading.replace("$1",video.src))}function videoLoadEnd(){let wae=getWae();0==this.readyState||this.videoHeight>0?wae.cover.style.display="none":wae.cover.style.display="",changeTitle("mediaName",currentMedia.vidname)}function changeTitle(type,context){top.postMessage({spec:"change-title",data:{type:type,context:context}},"*")}function switchLibrary(){void 0==self.states.list&&(states.list=!1),states.list?top.postMessage({spec:"switchTab",data:{context:"core"}},"*"):top.postMessage({spec:"switchTab",data:{context:"list"}},"*"),states.list=!states.list}function reqFsc(){top.postMessage({spec:"fullscreen"},"*")}function fireCustomStates(){let element=getAll();states.fullscreen?(element.controllers.fsc.children[0].style.display="none",element.controllers.fsc.children[1].style.display=""):(element.controllers.fsc.children[1].style.display="none",element.controllers.fsc.children[0].style.display="")}addEventListener("message",function(msg){switch(msg.data.spec){case"info":states[msg.data.data.type]=msg.data.data.context,fireCustomStates();break;default:console.warn(lang.noMsgSpec.replace("$1",msg.data.spec))}}),document.addEventListener("readystatechange",function(){if("interactive"==this.readyState.toLowerCase()){resizeAll(),requestLanguage(),themeIconChange("black"),addEventListener("resize",resizeAll,!0),audio=document.querySelector("#wmp-audio"),audioFallback=document.querySelector("#wmp-fallback"),video=document.querySelector("#wmp-video"),flvPlayer=null,flvPlayerAudio=null,document.body.onauxclick=(()=>!1),video.muted=!0;let element=getAll();if(element.controllers.progress.addEventListener("mousedown",function(){states.seek=!0}),element.controllers.progress.addEventListener("pointerdown",function(){states.seek=!0}),element.controllers.progress.addEventListener("pointerup",function(){states.seek=!1,seekMedia(parseFloat(element.controllers.progress.value)*video.duration)}),element.controllers.progress.addEventListener("mouseup",function(){states.seek=!1,seekMedia(parseFloat(element.controllers.progress.value)*video.duration)}),video.addEventListener("play",function(){element.controllers.play.children[0].style.display="none",element.controllers.play.children[1].style.display="none"}),video.addEventListener("pause",function(){element.controllers.play.children[0].style.display="inline",element.controllers.play.children[1].style.display="none"}),video.addEventListener("playing",function(){element.controllers.play.children[0].style.display="none",element.controllers.play.children[1].style.display="inline"}),video.addEventListener("durationchange",function(){element.indicators.duration.innerHTML=nte(video.duration)}),element.controllers.list.addEventListener("click",switchLibrary),element.controllers.fsc.addEventListener("click",reqFsc),video.addEventListener("readystatechange",function(){switch(this.readyState){case video.HAVE_NOTHING:case video.HAVE_METADATA:case video.HAVE_CURRENT_DATA:case video.HAVE_FUTURE_DATA:case video.HAVE_ENOUGH_DATA:}}),self.canvas={buffer:element.indicators.buffer.getContext("2d"),visualizer:element.indicators.visualizer.getContext("2d")},self.threads={},self.currentMedia={},element.controllers.play.onclick=switchStatus,video.addEventListener("loadstart",videoLoadStart),video.addEventListener("loadend",videoLoadEnd),self.states={seek:!1,playing:!1},startThreads(),self.TabSearch){let actions=new TabSearch(location.search);for(let name in actions)switch(name){case"nowa":"0"!=actions[name]&&console.info("WebAudio is disabled via search.");break;case"file":playMedia(actions[name]),console.info("Queried file [$1] via search.".replace("$1",actions[name]));break;case"start":seekMedia(parseFloat(actions[name])),console.info("Scheduled file start point [$1] via search.".replace("$1",actions[name]));break;case"shareid":console.info("Queried shared file [$1] via search.".replace("$1",actions[name]));break;case"theme":themeIconChange(actions[name]),console.info("Changed theme to [$1] via search.".replace("$1",actions[name]))}}document.body.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation()},!0),document.body.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!0),document.body.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation()},!0),document.body.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation(),loadFiles(e.dataTransfer.files)},!0),document.body.addEventListener("keydown",function(event){console.info(lang.keyPressed.replace("$1",event.which));let allowDefault=!1;switch(event.which){case 32:switchStatus();break;case 37:seekMedia(video.currentTime-=10);break;case 39:seekMedia(video.currentTime+=10);break;case 73:event.ctrlKey&&(allowDefault=!0)}return allowDefault})}}),switchStatus.PLAY=0,switchStatus.PAUSE=1,switchStatus.AUTO=2;